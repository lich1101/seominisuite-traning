var start=false;var recheckTotal=0;var recheckCount=0;var recheck=[];var waitingIDS=[];var now=0;var loadingHtml='<div class="loadingio-spinner-reload-nr0v98l51wb"><div class="ldio-nrb44wvqx8m">\n'+"        <div><div></div><div></div><div></div></div>\n"+"    </div></div>";function isScreenLockSupported(){return"wakeLock"in navigator}async function cassiopeia_start_check_backlink(response){let i=0;let delay=0;let _now=response.now;now=performance.now();let data=response.data;let stt=response.stt;while(i<=stt){let group=data[i];let groupSize=Object.size(group);if(start){$.each(group,function(index,_value){chrome.runtime.sendMessage({data:_value,delay:(performance.now()-now)/1e3+_now,currentObj:_value,type:"CheckBackLink"},function(response){});chrome.runtime.lastError=null})}else{break}await wait(2e3);delay+=2e3;i++;diff=(performance.now()-now)/1e3+_now;if(diff>=295){delay=0;await wait(4e4);now=performance.now();_now=0}}}chrome.runtime.onMessage.addListener(function(request,sender,sendResponse){let responseObj;let currentObj;switch(request.type){case"getNow":cassiopeia_start_check_backlink(request);break;case"may_doi_tao_30s":console.log("Be right back!");responseObj=request.responseObj;currentObj=responseObj.currentObj;switch(responseObj.checkType){case"CheckBackLinkIndexed":setTimeout(function(){if(start){cassiopeia_recursion_backlink_indexed_check(request.data,currentObj)}},4e4);break;case"KeyCheck":setTimeout(function(){if(start){cassiopeia_recursion_keyword_check(request.data,currentObj)}},4e4);break;case"CheckDuplicateContent":setTimeout(function(){if(start){cassiopeia_recursion_duplicate_check(request.data,currentObj)}},4e4);break}break;case"CheckBackLinkIndexed":if(start){responseObj=request.responseObj;currentObj=responseObj.currentObj;cassiopeia_recursion_backlink_indexed_check(request.data,currentObj,responseObj)}break;case"KeyCheck":if(start){responseObj=request.responseObj;currentObj=responseObj.currentObj;if(responseObj.timeout!==undefined&&responseObj.timeout==="timeout"){cassiopeia_recursion_keyword_check(request.data,currentObj)}else{cassiopeia_recursion_keyword_check(request.data,currentObj,responseObj)}}break;case"CheckBackLink":responseObj=request.responseObj;currentObj=responseObj.currentObj;if(responseObj.status==="ERROR"&&responseObj.recheck!==true){currentObj.recheck=true;recheck.push(currentObj)}else{}cassiopeia_recursion_backlink_check(request.data,currentObj,responseObj);break;case"CheckDuplicateContent":if(start){responseObj=request.responseObj;currentObj=responseObj.currentObj;cassiopeia_recursion_duplicate_check(request.data,currentObj,responseObj)}break;case"captcha_stop":if(start){responseObj=request.responseObj;currentObj=responseObj.currentObj;switch(responseObj.checkType){case"CheckBackLinkIndexed":setTimeout(function(){cassiopeia_recursion_backlink_indexed_check(request.data,currentObj)},3e3);break;case"KeyCheck":setTimeout(function(){cassiopeia_recursion_keyword_check(request.data,currentObj)},3e3);break;case"CheckDuplicateContent":setTimeout(function(){cassiopeia_recursion_duplicate_check(request.data,currentObj)},3e3);break}}break;case"captcha_dos":if(start){$(".extension-alert").addClass("active");responseObj=request.responseObj;currentObj=responseObj.currentObj;switch(responseObj.checkType){case"CheckBackLinkIndexed":setTimeout(function(){cassiopeia_recursion_backlink_indexed_check(request.data,currentObj);$(".extension-alert").removeClass("active")},3e5);break;case"KeyCheck":setTimeout(function(){cassiopeia_recursion_keyword_check(request.data,currentObj);$(".extension-alert").removeClass("active")},3e5);break;case"CheckDuplicateContent":setTimeout(function(){cassiopeia_recursion_duplicate_check(request.data,currentObj);$(".extension-alert").removeClass("active")},3e5);break}}break;case"captcha_not_hander":alert("Captcha không được giải tự động, vui lòng thao tác.");break}sendResponse({response:""});return true});$(document).ready(function(e){$("footer").addClass("seoToolExtension");$(".header-note").remove();document.addEventListener("CheckIndexed",function(e){start=true;$(".result").addClass("isLoading");$(".progress-bar-block").addClass("active");let totalBacklinks=0;let checkedBacklinks=0;$(".selectAll").prop("checked",false);let domain=$("#project_domain").val();let data={};let index=0;$("tbody input").each(function(e){let _this=$(this);if(_this.is(":checked")){totalBacklinks++;let _parent=$("tr").has(_this);_parent.addClass("checking");let temp={};temp["index"]=index;temp["id"]=_this.val();temp["stt"]=_this.attr("data-stt");temp["source"]=_this.attr("data-backlink-source");temp["domain"]=domain;data[index]=temp;index++}});$(".loading-block").removeClass("active");$("#totalItems").val(totalBacklinks);$("#checkedItems").val(checkedBacklinks);$(".progress-bar-block progress").attr("max",totalBacklinks);$(".progress-bar-block .totalBacklinks").text(totalBacklinks);if(Object.keys(data).length>0){let currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_backlink_indexed_check(data,currentObj)}});document.addEventListener("CheckDuplicateContent",function(e){start=true;$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-check-duplicate"},success:function(result){if(result.response=="EXPIRED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserExpired",{detail:"123"}))},500)}else if(result.response=="LIMITED"){setTimeout(function(){document.dispatchEvent(new CustomEvent("UserLimited",{detail:"123"}))},500)}else{$(".total-result span.none-duplicate").text("");$(".total-result span.duplicate").text("");$(".result").addClass("isLoading");let data={};let index=0;$(".part-of-content").each(function(e){let _this=$(this);let temp={};temp["index"]=index;temp["value"]=_this.text().trim();temp["id"]=_this.attr("data-id");data[index]=temp;index++});$("#totalItems").val(parseInt(index));$("#checkedItems").val(0);$(".progress-bar-block progress").attr("max",parseInt(index));$(".progress-bar-block progress").val(0);$(".progress-bar-block").addClass("active");if(Object.keys(data).length>0){let currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_duplicate_check(data,currentObj)}}}})});document.addEventListener("CheckBacklink",async function(e){start=true;$(".result").addClass("isLoading");$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-backlink-check-response-complete",value:0},success:function(result){}});$(".progress-bar-block").addClass("active");let totalBacklinks=0;let checkedBacklinks=0;let domain=$("#project_domain").val();domain=getDomainFromHref(domain);let data={};let stt=0;let index=0;let slice={};$("tbody input").each(function(e){let _this=$(this);if(_this.is(":checked")){totalBacklinks++;let _parent=$("tr").has(_this);_parent.addClass("checking");let temp={};temp["recheck"]=false;temp["index"]=index;temp["id"]=_this.val();temp["stt"]=_this.attr("data-stt");temp["source"]=_this.attr("data-backlink-source");temp["domain"]=domain;slice[index]=temp;if((index+1)%5===0){data[stt]=slice;slice={};stt++}index++}data[stt]=slice});$(".loading-block").removeClass("active");$("#totalItems").val(totalBacklinks);$("#checkedItems").val(checkedBacklinks);$(".progress-bar-block progress").attr("max",totalBacklinks);$(".progress-bar-block .totalBacklinks").text(totalBacklinks);$("input").prop("checked",false);chrome.runtime.sendMessage({data:data,stt:stt,type:"getNow",checkType:"backlink"},function(response){});chrome.runtime.lastError=null;let timer=0});document.addEventListener("CheckKeyword",function(e){start=true;$(".result").addClass("isLoading");let totalBacklinks=0;let checkedBacklinks=0;$(".progress-bar-block").addClass("active");$(".selectAll").prop("checked",false);let domain=$("#project_domain").val();domain=getDomainFromHref(domain);let searchEngine=$("select[name='search-engine']").val();let language=$("select[name='language']").val();let data={};let index=0;$("tbody input").each(function(e){let _this=$(this);if(_this.is(":checked")){totalBacklinks++;let _parent=$("tr").has(_this);_parent.addClass("checking");let temp={};temp["index"]=index;temp["id"]=_this.attr("data-id");temp["key"]=_this.attr("data-key");temp["domain"]=domain;temp["stt"]=_this.attr("data-stt");temp["searchEngine"]=searchEngine;temp["language"]=language;data[index]=temp;index++}});$(".loading-block").removeClass("active");$("#totalItems").val(totalBacklinks);$("#checkedItems").val(checkedBacklinks);$(".progress-bar-block progress").attr("max",totalBacklinks);$(".progress-bar-block .totalBacklinks").text(totalBacklinks);if(Object.keys(data).length>0){let currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_keyword_check(data,currentObj)}})});function cassiopeia_recursion_duplicate_check(data,currentObj,responseObject=1){if(responseObject===1){chrome.runtime.sendMessage({data:data,currentObj:currentObj,type:"CheckDuplicateContent"},function(response){});chrome.runtime.lastError=null}else{let listOfID=[];let running=true;if($("#listOfID").attr("data-value")!==""){listOfID=JSON.parse($("#listOfID").attr("data-value"))}if(listOfID.length>0){if(listOfID.includes(currentObj.id)!==true){listOfID.push(currentObj.id);$("#listOfID").attr("data-value",JSON.stringify(listOfID));let checkedItems=$("#checkedItems").val();let totalItems=$("#totalItems").val();if(parseInt(checkedItems)<=parseInt(totalItems)&&parseInt(totalItems)!==0){checkedItems++;$("#checkedItems").val(checkedItems);$(".progress-bar-block progress").val(checkedItems)}if(parseInt(checkedItems)===parseInt(totalItems)){$("#totalItems").val(0);$("#checkedItems").val(0);$(".progress-bar-block").removeClass("active")}let dom_nodes=$($.parseHTML(responseObject.content[0]));let gNodes=dom_nodes.find("div.g");let check=false;let sources=[];let domainName=$(".domain-name input").val();let domains=[];if(domainName.length>0){let domain_list=JSON.parse(domainName);if(domain_list.length>0){domain_list.forEach(function(item,index){let _domain=getDomainFromHref(item.value);domains.push(_domain)})}}domainName=getDomainFromHref(domainName);$.each(gNodes,function(index,_value){if($(_value).text().toLowerCase().includes(currentObj.value.toLowerCase())){let _href=$(_value).find("a").attr("href");let _domain_href=getDomainFromHref(_href);if(domains.length>0&&domains.includes(_domain_href)){}else{let _domain_href=getDomainFromHref(_href);let _url="<a target='_blank' href='"+_href+"'>"+_domain_href+"</a>";if(sources.length<=5){sources.push(_url)}check=true}}});let _result='<i class="fa fa-check"></i>';if(check===true){_result='<i class="fa fa-times"></i>'}let element=$("td[data-id='"+currentObj.id+"']").parent().find(".check-result");let element_top=$("td[data-id="+currentObj.id+"]").parent().find(".check-result").position().top;$(".t-body").scrollTop(element_top-60);let elementSource=$("td[data-id='"+currentObj.id+"']").parent().find(".sources");element.html(_result);elementSource.html(""+sources.join(" "));element.attr("data-duplicate",check);if(check){element.attr("data-value",1)}else{element.attr("data-value",0)}delete data[currentObj.index];if(Object.keys(data).length>0){currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_duplicate_check(data,currentObj);$(".progress-bar-block progress").val(checkedItems)}else{let totalResult=$(".check-result").length;let duplicateResult=$(".check-result[data-duplicate='true']").length;let noneDuplicate=parseInt((1-duplicateResult/totalResult)*100);$(".total-result span.none-duplicate").text(noneDuplicate+"%");$(".total-result span.duplicate").text(100-parseInt(noneDuplicate)+"%");$(".btn-check-duplicate-content").prop("disabled",null);$(".result").removeClass("isLoading");setTimeout(function(){$(".t-body").scrollTop(0);$("#listOfID").attr("data-value","");alert("Đã kiểm tra xong!")},1e3)}}}else{listOfID.push(currentObj.id);$("#listOfID").attr("data-value",JSON.stringify(listOfID));let checkedItems=$("#checkedItems").val();let totalItems=$("#totalItems").val();if(parseInt(checkedItems)<=parseInt(totalItems)&&parseInt(totalItems)!==0){checkedItems++;$("#checkedItems").val(checkedItems);$(".progress-bar-block progress").val(checkedItems)}if(parseInt(checkedItems)===parseInt(totalItems)){$("#totalItems").val(0);$("#checkedItems").val(0);$(".progress-bar-block").removeClass("active")}let dom_nodes=$($.parseHTML(responseObject.content[0]));let gNodes=dom_nodes.find("div.g");let check=false;let sources=[];let domainName=$(".domain-name input").val();let domains=[];if(domainName.length>0){let domain_list=JSON.parse(domainName);if(domain_list.length>0){domain_list.forEach(function(item,index){let _domain=getDomainFromHref(item.value);domains.push(_domain)})}}domainName=getDomainFromHref(domainName);$.each(gNodes,function(index,_value){if($(_value).text().toLowerCase().includes(currentObj.value.toLowerCase())){let _href=$(_value).find("a").attr("href");let _domain_href=getDomainFromHref(_href);if(domains.length>0&&domains.includes(_domain_href)){}else{let _domain_href=getDomainFromHref(_href);let _url="<a target='_blank' href='"+_href+"'>"+_domain_href+"</a>";if(sources.length<=5){sources.push(_url)}check=true}}});let _result='<i class="fa fa-check"></i>';if(check===true){_result='<i class="fa fa-times"></i>'}let element=$("td[data-id='"+currentObj.id+"']").parent().find(".check-result");let element_top=$("td[data-id="+currentObj.id+"]").parent().find(".check-result").position().top;$(".t-body").scrollTop(element_top-60);let elementSource=$("td[data-id='"+currentObj.id+"']").parent().find(".sources");element.html(_result);elementSource.html(""+sources.join(" "));element.attr("data-duplicate",check);if(check){element.attr("data-value",1)}else{element.attr("data-value",0)}delete data[currentObj.index];if(Object.keys(data).length>0){currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_duplicate_check(data,currentObj);$(".progress-bar-block progress").val(checkedItems)}else{let totalResult=$(".check-result").length;let duplicateResult=$(".check-result[data-duplicate='true']").length;let noneDuplicate=parseInt((1-duplicateResult/totalResult)*100);$(".total-result span.none-duplicate").text(noneDuplicate+"%");$(".total-result span.duplicate").text(100-parseInt(noneDuplicate)+"%");$(".btn-check-duplicate-content").prop("disabled",null);$(".result").removeClass("isLoading");setTimeout(function(){$(".t-body").scrollTop(0);$("#listOfID").attr("data-value","");alert("Đã kiểm tra xong!")},1e3)}}}}function cassiopeia_recursion_backlink_indexed_check(data,currentObj,responseObject=1){if(responseObject===1){chrome.runtime.sendMessage({data:data,currentObj:currentObj,type:"CheckBackLinkIndexed"},function(response){});chrome.runtime.lastError=null}else{let indexed=0;let indexedText="Không";let dom_nodes=$($.parseHTML(responseObject.content[0]));let gNodes=dom_nodes.find("div.g");if(gNodes.length>=1){indexed=1;indexedText="Indexed"}$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-backlink-check-indexed-response",id:responseObject.id,indexed:indexed},success:function(result){if(result.response=="EXPIRED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserExpired",{detail:"123"}))},500)}else if(result.response=="LIMITED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserLimited",{detail:"123"}))},500)}else{let html="";$.each(JSON.parse(result.values),function(index,value){t=renderBacklinkRow(value,currentObj.stt);html+=t});$(html).replaceAll(".page-user-backlink-project-detail tr[data-nid="+currentObj.id+"]");let element=$("tr[data-nid="+currentObj.id+"]").position().top;$(".t-body").scrollTop(element-60);let checkedItems=$("#checkedItems").val();let totalItems=$("#totalItems").val();if(parseInt(checkedItems)<=parseInt(totalItems)&&parseInt(totalItems)!==0){checkedItems++;$("#checkedItems").val(checkedItems);$(".progress-bar-block progress").val(checkedItems);$(".progress-bar-block .checkedBacklinks").text(checkedItems)}if(parseInt(checkedItems)==parseInt(totalItems)){$("#totalItems").val(0);$("#checkedItems").val(0);$(".progress-bar-block").removeClass("active")}delete data[currentObj.index];if(Object.keys(data).length>0){currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_backlink_indexed_check(data,currentObj)}else{setTimeout(function(){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"check-complete",value:1},success:function(result){location.reload()}})},1e3)}}},error:function(textStatus,errorThrown){let checkedItems=$("#checkedItems").val();let totalItems=$("#totalItems").val();if(parseInt(checkedItems)<=parseInt(totalItems)&&parseInt(totalItems)!==0){checkedItems++;$("#checkedItems").val(checkedItems);$(".progress-bar-block progress").val(checkedItems);$(".progress-bar-block .checkedBacklinks").text(checkedItems)}if(parseInt(checkedItems)==parseInt(totalItems)){$("#totalItems").val(0);$("#checkedItems").val(0);$(".progress-bar-block").removeClass("active")}delete data[currentObj.index];if(Object.keys(data).length>0){currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_backlink_indexed_check(data,currentObj)}else{setTimeout(function(){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"check-complete",value:1},success:function(result){location.reload()}})},1e3)}}})}}function cassiopeia_recursion_backlink_check(data,currentObj,responseObject=1){if(responseObject===1){chrome.runtime.sendMessage({data:data,currentObj:currentObj,type:"CheckBackLink"},function(response){});chrome.runtime.lastError=null}else{let listOfID=[];let running=true;if($("#listOfID").attr("data-value")!==""){listOfID=JSON.parse($("#listOfID").attr("data-value"))}if(listOfID.length>0){if(listOfID.includes(currentObj.id)!==true){listOfID.push(currentObj.id);$("#listOfID").attr("data-value",JSON.stringify(listOfID));checkBacklinkResponse(currentObj,responseObject,running)}else{let __data=responseObject;if(responseObject.status===200){let responseText=responseObject.responseText[0];let dom_nodes=$($.parseHTML(responseText));let gNodes=dom_nodes.find("a[href*='"+currentObj.domain+"']");let _indexed=0;if(gNodes.length!==0){let backlink=[];for(let i=0;i<gNodes.length;i++){let temp={};let isInContent=0;let gNode=gNodes[i];let gNodeParent=$(gNode).parents("p");let gNodeGrandParent=$(gNodeParent).parent();if(gNodeGrandParent.length>0&&gNodeGrandParent.find("p").length>1){isInContent=1}let _href=$(gNode).attr("href");let _rel=$(gNode).attr("rel");let _anchorText=$(gNode).text();temp["isInContent"]=isInContent;temp["_href"]=_href;temp["_rel"]=_rel;temp["_anchorText"]=_anchorText;backlink.push(temp)}__data["backlink"]=backlink}}$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-backlink-check-response",responseObject:JSON.stringify(__data)},success:function(result){if(result.response=="EXPIRED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserExpired",{detail:"123"}))},500)}else if(result.response=="LIMITED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserLimited",{detail:"123"}))},500)}else{if(result.response!="FAIL"){let html="";$.each(JSON.parse(result.values),function(index,value){t=renderBacklinkRow(value,currentObj.stt);html+=t});$(html).replaceAll(".page-user-backlink-project-detail tr[data-nid="+currentObj.id+"]")}}}});if(running){if(currentObj.recheck==true){let checkedItems=$("#checkedItems").val();let totalItems=$("#totalItems").val();if(parseInt(checkedItems)<=parseInt(totalItems)&&parseInt(totalItems)!==0){checkedItems++;$("#checkedItems").val(checkedItems);$(".progress-bar-block progress").val(checkedItems);$(".progress-bar-block .checkedBacklinks").text(checkedItems)}if(parseInt(checkedItems)==parseInt(totalItems)){$("#totalItems").val(0);$("#checkedItems").val(0);$(".progress-bar-block").removeClass("active");$(".result").removeClass("loading");setTimeout(function(){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-backlink-check-response-complete",value:1,responseObject:JSON.stringify(responseObject)},success:function(result){if(result.response=="EXPIRED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserExpired",{detail:"123"}))},500)}else{location.reload()}}})},1e3)}}}}}else{listOfID.push(currentObj.id);$("#listOfID").attr("data-value",JSON.stringify(listOfID));checkBacklinkResponse(currentObj,responseObject,running)}}}async function checkBacklinkResponse(currentObj,responseObject,running){let checkedItems=$("#checkedItems").val();let totalItems=$("#totalItems").val();if(parseInt(checkedItems)<=parseInt(totalItems)&&parseInt(totalItems)!==0){checkedItems++;$("#checkedItems").val(checkedItems);$(".progress-bar-block progress").val(checkedItems);$(".progress-bar-block .checkedBacklinks").text(checkedItems)}let __data=responseObject;if(responseObject.status===200){let responseText=responseObject.responseText[0];let dom_nodes=$($.parseHTML(responseText));let gNodes=dom_nodes.find("a[href*='"+currentObj.domain+"']");let _indexed=0;if(gNodes.length!==0){let backlink=[];for(let i=0;i<gNodes.length;i++){let temp={};let isInContent=0;let gNode=gNodes[i];let gNodeParent=$(gNode).parents("p");let gNodeGrandParent=$(gNodeParent).parent();if(gNodeGrandParent.length>0&&gNodeGrandParent.find("p").length>1){isInContent=1}let _href=$(gNode).attr("href");let _rel=$(gNode).attr("rel");let _anchorText=$(gNode).text();temp["isInContent"]=isInContent;temp["_href"]=_href;temp["_rel"]=_rel;temp["_anchorText"]=_anchorText;backlink.push(temp)}__data["backlink"]=backlink}}$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-backlink-check-response",responseObject:JSON.stringify(__data)},success:async function(result){if(result.response=="EXPIRED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserExpired",{detail:"123"}))},500)}else if(result.response=="LIMITED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserLimited",{detail:"123"}))},500)}else{if(result.response!="FAIL"){let html="";$.each(JSON.parse(result.values),function(index,value){t=renderBacklinkRow(value,currentObj.stt);html+=t});$(html).replaceAll(".page-user-backlink-project-detail tr[data-nid="+currentObj.id+"]");let element=$("tr[data-nid="+currentObj.id+"]");if(element.length>0){$(".t-body").scrollTop(element.position().top)}}}}});if(running){if(parseInt(checkedItems)==parseInt(totalItems)){if(recheck.length>0){recheckTotal=recheck.length;$("#totalItems").val(recheckTotal);$("#checkedItems").val(0);$(".progress-bar-block progress").attr("max",recheckTotal);$(".progress-bar-block .totalBacklinks").text(recheckTotal);let newdata={};let stt=0;let slice={};$.each(recheck,function(index,_value){slice[index]=_value;if((index+1)%5===0){newdata[stt]=slice;slice={};stt++}});newdata[stt]=slice;let i=0;while(i<=stt){let group=newdata[i];let groupSize=Object.size(group);$.each(group,function(index,_value){chrome.runtime.sendMessage({data:_value,currentObj:_value,delay:(performance.now()-now)/1e3,type:"CheckBackLink"},function(response){});chrome.runtime.lastError=null});wait(2e3);i++;diff=(performance.now()-now)/1e3;if(diff>=295){delay=0;await wait(4e4);now=performance.now()}}}else{$("#totalItems").val(0);$("#checkedItems").val(0);$(".progress-bar-block").removeClass("active");$(".result").removeClass("loading");setTimeout(function(){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-backlink-check-response-complete",value:1,responseObject:JSON.stringify(responseObject)},success:function(result){if(result.response=="EXPIRED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserExpired",{detail:"123"}))},500)}else if(result.response=="LIMITED"){start=false;running=false;setTimeout(function(){document.dispatchEvent(new CustomEvent("UserLimited",{detail:"123"}))},500)}else{location.reload()}}})},1e3)}}}}function keywordResponse(data,currentObj,responseObject,running){let checkedItems=$("#checkedItems").val();let totalItems=$("#totalItems").val();if(parseInt(checkedItems)<=parseInt(totalItems)&&parseInt(totalItems)!==0){checkedItems++;$("#checkedItems").val(checkedItems);$(".progress-bar-block progress").val(checkedItems);$(".progress-bar-block .checkedBacklinks").text(checkedItems)}if(parseInt(checkedItems)==parseInt(totalItems)){$("#totalItems").val(0);$("#checkedItems").val(0);$(".progress-bar-block").removeClass("active")}let domain=$("#project_domain").val();domain=getDomainFromHref(domain);let check=false;let dom_nodes=$($.parseHTML(responseObject.content[0]));let gNodes=dom_nodes.find("div.g");let _index;let result={};let stt=0;let minIndex;let minHref;let lastKey=0;$.each(gNodes,function(index,_value){if($(_value).find("a").length){let _href=$(_value).find("a").attr("href");if(typeof _href!=="undefined"&&_href!==false){let _domain_href=getDomainFromHref(_href);if(_domain_href.toLowerCase().includes(domain.toLowerCase())&&domain.toLowerCase().includes(_domain_href.toLowerCase())){if(stt==0){minIndex=index}else{if(parseInt(index)<parseInt(minIndex)){minIndex=index}}check=true;minHref=_href;stt++}}}});if(check==true){result["index"]=minIndex;result["url"]=minHref}if(Object.keys(data).length==1){lastKey=1}if(check!==true){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-key-check",id:currentObj.id,index:-1,lastKey:lastKey,stt:currentObj.stt},success:function(result){if(result.response.status=="EXPIRED"){setTimeout(function(){document.dispatchEvent(new CustomEvent("UserExpired",{detail:"123"}))},500)}else if(result.response.status=="LIMITED"){setTimeout(function(){document.dispatchEvent(new CustomEvent("UserLimited",{detail:"123"}))},500)}else{$(result.html).replaceAll(".page-keyword-project-detail tr[data-nid="+currentObj.id+"]");let element=$("tr[data-nid="+currentObj.id+"]").position().top;$(".t-body").scrollTop(element-60);delete data[currentObj.index];if(Object.keys(data).length>0){currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_keyword_check(data,currentObj)}else{setTimeout(function(){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"check-complete",value:1},success:function(result){location.reload()}})},1e3)}}},error:function(textStatus,errorThrown){$(result.html).replaceAll(".page-keyword-project-detail tr[data-nid="+currentObj.id+"]");let element=$("tr[data-nid="+currentObj.id+"]").position().top;$(".t-body").scrollTop(element-60);delete data[currentObj.index];if(Object.keys(data).length>0){currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_keyword_check(data,currentObj)}else{setTimeout(function(){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"check-complete",value:1},success:function(result){location.reload()}})},1e3)}}})}else{$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"user-key-check",id:currentObj.id,stt:currentObj.stt,index:JSON.stringify(result),lastKey:lastKey},success:function(result){if(result.response.status=="EXPIRED"){setTimeout(function(){document.dispatchEvent(new CustomEvent("UserExpired",{detail:"123"}))},500)}else if(result.response.status=="LIMITED"){setTimeout(function(){document.dispatchEvent(new CustomEvent("UserLimited",{detail:"123"}))},500)}else{$(result.html).replaceAll(".page-keyword-project-detail tr[data-nid="+currentObj.id+"]");let element=$("tr[data-nid="+currentObj.id+"]").position().top;$(".t-body").scrollTop(element-60);delete data[currentObj.index];if(Object.keys(data).length>0){currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_keyword_check(data,currentObj)}else{setTimeout(function(){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"check-complete",value:1},success:function(result){location.reload()}})},1e3)}}},error:function(textStatus,errorThrown){$(result.html).replaceAll(".page-keyword-project-detail tr[data-nid="+currentObj.id+"]");let element=$("tr[data-nid="+currentObj.id+"]").position().top;$(".t-body").scrollTop(element-60);delete data[currentObj.index];if(Object.keys(data).length>0){currentObj=data[Object.keys(data)[0]];cassiopeia_recursion_keyword_check(data,currentObj)}else{setTimeout(function(){$.ajax({method:"POST",url:"https://seominisuite.com/cassiopeia/ajax",data:{cmd:"check-complete",value:1},success:function(result){location.reload()}})},1e3)}}})}}function cassiopeia_recursion_keyword_check(data,currentObj,responseObject=null){if(responseObject===null){chrome.runtime.sendMessage({data:data,currentObj:currentObj,type:"KeyCheck"},function(response){});chrome.runtime.lastError=null}else{let listOfID=[];let running=true;if($("#listOfID").attr("data-value")!==""){listOfID=JSON.parse($("#listOfID").attr("data-value"))}if(listOfID.length>0){listOfID.push(currentObj.id);$("#listOfID").attr("data-value",JSON.stringify(listOfID));keywordResponse(data,currentObj,responseObject,running)}else{listOfID.push(currentObj.id);$("#listOfID").attr("data-value",JSON.stringify(listOfID));keywordResponse(data,currentObj,responseObject,running)}}}function removeElement(array,elem){var index=array.indexOf(elem);if(index>-1){array.splice(index,1)}}function getDomainFromHref(href){let a=href.split("//");let d;if(a.length<2){d=a[0]}else{d=a[1]}let c="";if(d!==null&&d!==""&&d!==undefined){let b=d.split("/");c=b[0].toLowerCase();c=c.replaceAll("www.","")}return c}async function wait(time){return new Promise(resolve=>{setTimeout(resolve,time)})}Object.size=function(obj){let size=0,key;for(key in obj){if(obj.hasOwnProperty(key))size++}return size};function renderBacklinkRow(value,stt){let is_in_content="-";if(value.is_in_content==1){is_in_content="Yes"}else if(value.is_in_content==0){is_in_content="No"}let indexed="-";if(value.indexed==1){indexed="Yes"}else{indexed="No"}let tags="";if(value.tags!==null){tags=value.tags}let status="";let errorCode="";let errorMessage="";if(value.status!==null){if(parseInt(value.status)!==200){switch(parseInt(value.status)){case"404":errorCode=404;errorMessage="Lỗi "+errorCode+": Nguồn đặt Backlink không tồn tại!";break;case"999":errorCode="error";errorMessage="Lỗi "+errorCode+": Nguồn đặt Backlink không hợp lệ!";break;case"500":errorCode=500;errorMessage="Lỗi "+errorCode+": Nguồn đặt Backlink không hoạt động!";break;default:errorCode=value.status;errorMessage="Lỗi "+errorCode}errorCode='FAIL <i class="fa fa-info-circle" title=\''+errorMessage+"'></i>"}else{errorCode="SUCCESS"}}if(value.id==null){errorCode="FAIL <i title='Không tìm thấy backlink!' class=\"fa fa-info-circle\" ></i>"}let t="<tr data-nid='"+value.bid+"'>\n"+'<td class="col-expand"></td>'+"    <td class='col-checkbox'>"+'<label class="mask-chekbox">\n'+'    <input data-stt="" type="checkbox" name="select" class="" data-domain="" value=\''+value.bid+"' data-backlink-source='"+value.source+"' >\n"+'    <span class="mask-checked"></span>\n'+"</label>"+"</td>\n"+"    <td class='w-3' style='white-space: nowrap'>"+stt+"</td>\n"+"    <td class='w-18 text-blue'>"+value.source+"</td>\n"+"    <td><span class='loading-item'></span><span class='td-content'>"+value.rel+"</span></td>\n"+"    <td><span class='loading-item'></span><span class='td-content'>"+value.anchor_text+"</span></td>\n"+"    <td class='text-blue'><span class='loading-item'></span><span class='td-content'>"+value.url+"</span></td>\n"+"    <td><span class='loading-item'></span><span class='td-content "+indexed+"'>"+indexed+"</span></td>\n"+"    <td style='    word-break: unset;'>"+tags+"</td>\n"+"    <td>"+value.date_created+"</td>\n"+"    <td><span class='loading-item'></span><span class='td-content'><span title='"+errorMessage+"'>"+errorCode+"</span></span></td>\n"+"</tr>";return t}