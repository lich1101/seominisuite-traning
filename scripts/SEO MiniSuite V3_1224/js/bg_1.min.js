var onlytabs=["https://seominisuite.com/quan-ly-backlink/du-an","https://seominisuite.com/kiem-tra-dao-van","https://seominisuite.com/quan-ly-keywords/du-an"];var executeTab=null;var executeTabDelay=12e4;var executeTabTimeout=0;var request=null;var sender=null;var spinUrlRequest="";var tabRemoves={};function resetAll(){chrome.storage.local.set({executeTab:null});chrome.storage.local.set({request:null});chrome.storage.local.set({sender:null})}function setTabId(editorExtensionId,tab){console.log("tab",tab);document.body.setAttribute("editorExtensionId",editorExtensionId)}async function wait(time){return new Promise(resolve=>{setTimeout(resolve,time)})}async function tabDragging(callback){chrome.windows.getAll({populate:true},function(windows){var window=windows.filter(function(x){return x.type==="normal"&&x.focused&&x.tabs&&x.tabs.length})[0];if(window===undefined){return}else{var tab=window.tabs[0];chrome.tabs.move(tab.id,{index:tab.index},function(){callback(chrome.runtime.lastError&&chrome.runtime.lastError.hasOwnProperty("message")&&chrome.runtime.lastError.message.indexOf("dragging")!==-1)})}})}async function deleteTab(tab){return new Promise((resolve,reject)=>{try{chrome.tabs.remove(tab.id,function(tabIds){resolve(tabIds)});removeError()}catch(e){reject(e)}})}function removeError(){chrome.runtime.lastError=null}function getAllTabs(options){return new Promise((resolve,reject)=>{try{chrome.tabs.query(options,function(tabs){resolve(tabs)})}catch(e){reject(e)}})}function cassiopeiaSendResponse(data,responseObj,sender,type){chrome.tabs.sendMessage(sender.tab.id,{type:type,data:data,responseObj:responseObj},function(response){chrome.power.releaseKeepAwake();removeError()})}function cassiopeiaPromiseResponseError(error,_request,_sender,waitStatus){let value="error";return cassiopeiaPromiseResponse(value,_request,_sender,false)}async function cassiopeiaPromiseResponse(value,_request,_sender,waitStatus){let data={};if(value!==undefined){data["currentObj"]=_request.currentObj;if(value==="waiting"){data["index"]=_request.currentObj.index;data["id"]=_request.currentObj.id;data["stt"]=_request.currentObj.stt;data["status"]="TIME_OUT";data["waitStatus"]="waiting";cassiopeiaSendResponse(_request.data,data,_sender,_request.type)}else if(value==="error"){data["index"]=_request.currentObj.index;data["id"]=_request.currentObj.id;data["stt"]=_request.currentObj.stt;data["recheck"]=_request.currentObj.recheck;data["waitStatus"]=true;data["status"]="ERROR";cassiopeiaSendResponse(_request.data,data,_sender,_request.type)}else{let status=value.status;let responseText=await value.text();data["index"]=_request.currentObj.index;data["id"]=_request.currentObj.id;data["stt"]=_request.currentObj.stt;data["waitStatus"]=waitStatus;data["status"]=status;data["responseText"]=new Array(responseText);cassiopeiaSendResponse(_request.data,data,_sender,_request.type)}}}chrome.runtime.onMessage.addListener(async function(_request,_sender,sendResponse){chrome.power.requestKeepAwake("system");if(_request.type==="captcha_dos"){if(sender&&executeTab&&executeTab.id==_sender.tab.id){let responseObj={};responseObj["index"]=request.currentObj.index;responseObj["id"]=request.currentObj.id;responseObj["currentObj"]=request.currentObj;responseObj["checkType"]=request.type;cassiopeiaSendResponse(request.data,responseObj,sender,"captcha_dos");chrome.tabs.remove(_sender.tab.id,function(){});resetAll();executeTab=null;sender=null;request=null}sendResponse({response:true})}else if(_request.type==="captcha_not_hander"){let responseObj={};responseObj["index"]=request.currentObj.index;responseObj["id"]=request.currentObj.id;responseObj["currentObj"]=request.currentObj;responseObj["checkType"]=request.type;cassiopeiaSendResponse(request.data,responseObj,sender,"captcha_stop");resetAll();executeTab=null;sender=null;request=null}else{chrome.storage.local.set({request:_request});chrome.storage.local.set({sender:_sender});request=_request;sender=_sender;sendResponse({response:""});if(_request.type==="KeyCheck"){console.log(":request",request.currentObj.key);let linkUrl=_request.currentObj.searchEngine+"/search?q="+_request.currentObj.key+"&num=100&hl="+_request.currentObj.language+"&start=0&ie=utf-8&oe=utf-8";let response=await fetch(linkUrl).catch(error=>{console.log("error",error)});let responseText=await response.text();if(response.url.includes("sorry/index?continue=https://www.google.com")){chrome.tabs.create({url:response.url,active:false},async function(tab){var editorExtensionId=chrome.runtime.id;const tabId=await tab.id;if(!tab.url)await onTabUrlUpdated(tabId);const results=await chrome.scripting.executeScript({target:{tabId:tabId},func:setTabId,args:[editorExtensionId,tab]},()=>{});const sss=await chrome.scripting.executeScript({target:{tabId:tabId,allFrames:true},files:["js/tab_captcha.js"]},result=>{chrome.storage.local.set({executeTab:tab});executeTab=tab;if(executeTabTimeout!=0){clearTimeout(executeTabTimeout)}executeTabTimeout=setTimeout(function(){if(sender&&sender.tab.id==_sender.tab.id&&executeTab&&executeTab.id==tabId){let responseObj={};responseObj["timeout"]="timeout";responseObj["index"]=_request.currentObj.index;responseObj["url"]=_request.currentObj.url;responseObj["id"]=_request.currentObj.id;responseObj["stt"]=_request.currentObj.stt;responseObj["currentObj"]=_request.currentObj;responseObj["content"]=new Array(responseText);cassiopeiaSendResponse(_request.data,responseObj,_sender,"KeyCheck");resetAll();request=null;sender=null;executeTab=null}clearTimeout(executeTabTimeout);executeTabTimeout=0},executeTabDelay)})})}else{let responseObj={};responseObj["index"]=_request.currentObj.index;responseObj["url"]=_request.currentObj.url;responseObj["id"]=_request.currentObj.id;responseObj["stt"]=_request.currentObj.stt;responseObj["currentObj"]=_request.currentObj;responseObj["content"]=new Array(responseText);cassiopeiaSendResponse(_request.data,responseObj,_sender,"KeyCheck")}}else if(_request.type==="CheckBackLinkIndexed"){let linkUrl="https://www.google.com/search?q=site:"+_request.currentObj.source+"&hl=vi";let response=await fetch(linkUrl).catch(error=>{console.log("error",error)});let responseText=await response.text();if(response.url.includes("sorry/index?continue=https://www.google.com")){chrome.tabs.create({url:response.url,active:false},async function(tab){var editorExtensionId=chrome.runtime.id;const tabId=tab.id;if(!tab.url)await onTabUrlUpdated(tabId);const results=await chrome.scripting.executeScript({target:{tabId:tabId},func:setTabId,args:[editorExtensionId]},ee=>{console.log("ee",ee);chrome.scripting.executeScript({target:{tabId:tabId,allFrames:true},files:["js/tab_captcha.js"]},result=>{console.log("result",result);executeTab=tab;if(executeTabTimeout!=0){clearTimeout(executeTabTimeout)}executeTabTimeout=setTimeout(function(){if(sender&&sender.tab.id==_sender.tab.id&&executeTab&&executeTab.id==tab.id){let responseObj={};responseObj["index"]=_request.currentObj.index;responseObj["id"]=_request.currentObj.id;responseObj["backlink"]=_request.currentObj.backlink;responseObj["currentObj"]=_request.currentObj;responseObj["content"]=new Array(responseText);cassiopeiaSendResponse(_request.data,responseObj,_sender,"CheckBackLinkIndexed");resetAll();request=null;sender=null;executeTab=null}clearTimeout(executeTabTimeout);executeTabTimeout=0},executeTabDelay)})})})}else{let responseObj={};responseObj["index"]=request.currentObj.index;responseObj["id"]=request.currentObj.id;responseObj["backlink"]=request.currentObj.backlink;responseObj["currentObj"]=request.currentObj;responseObj["content"]=new Array(responseText);cassiopeiaSendResponse(request.data,responseObj,sender,"CheckBackLinkIndexed");resetAll();request=null;sender=null;executeTab=null}}else if(_request.type==="CheckBackLink"){let _error=false;const longTask=()=>new Promise(resolve=>resolve(fetch(_request.currentObj.source))).then(value=>cassiopeiaPromiseResponse(value,_request,_sender,true)).catch(_error=>cassiopeiaPromiseResponseError(_error,_request,_sender,false));const timeout=(cb,interval)=>()=>new Promise(resolve=>setTimeout(()=>cb(resolve),interval));const onTimeout=timeout(resolve=>resolve("waiting"),6e5);Promise.race([longTask,onTimeout].map(f=>f())).then(value=>cassiopeiaPromiseResponse(value,_request,_sender,true));return true}else if(_request.type==="CheckDuplicateContent"){let linkUrl='https://www.google.com/search?q="'+_request.currentObj.value+'"&num=100&hl=vi&start=0&ie=utf-8&oe=utf-8';let _error=false;let response=await fetch(linkUrl).catch(error=>{_error=true});if(_error!==true){let responseText=await response.text();if(response.url.includes("sorry/index?continue=https://www.google.com")){chrome.tabs.create({url:response.url,active:false},async function(tab){var editorExtensionId=chrome.runtime.id;const tabId=tab.id;if(!tab.url)await onTabUrlUpdated(tabId);const results=await chrome.scripting.executeScript({target:{tabId:tabId},func:setTabId,args:[editorExtensionId]},()=>{chrome.scripting.executeScript({target:{tabId:tabId,allFrames:true},files:["js/tab_captcha.js"]},result=>{executeTab=tab;if(executeTabTimeout!=0){clearTimeout(executeTabTimeout)}})})})}else{let responseObj={};responseObj["index"]=_request.currentObj.index;responseObj["id"]=_request.currentObj.id;responseObj["currentObj"]=request.currentObj;responseObj["content"]=new Array(responseText);cassiopeiaSendResponse(_request.data,responseObj,_sender,"CheckDuplicateContent")}}else{}}}return true});function loadTabJS(){}chrome.tabs.onUpdated.addListener(async function(tabId,changeInfo,tab){if(request!==null&&request.currentObj!==null){console.log(":request",request.currentObj.key)}else{console.log(":request",null)}$checkInonlytabs=false;for(var i=0;i<onlytabs.length;i++){if(tab.url.includes(onlytabs[i])===true){$checkInonlytabs=true}}if($checkInonlytabs){var tabs=await getAllTabs({});$counterTab=0;if(tabs&&tabs.hasOwnProperty("length")){for(var i=0;i<tabs.length;i++){for(var j=0;j<onlytabs.length;j++){if(tabs[i].url.includes(onlytabs[j])===true){$counterTab=$counterTab+1}}}}if($counterTab>=2){wait(500);await deleteTab(tab);chrome.runtime.lastError=null;alert("Vui lòng chỉ mở 1 tab chức năng!")}else{afterUpdateTab(tabId,changeInfo,tab)}}else{afterUpdateTab(tabId,changeInfo,tab)}});function onTabUrlUpdated(tabId){return new Promise((resolve,reject)=>{const onUpdated=(id,info)=>id===tabId&&info.url&&done(true);const onRemoved=id=>id===tabId&&done(false);chrome.tabs.onUpdated.addListener(onUpdated);chrome.tabs.onRemoved.addListener(onRemoved);function done(ok){chrome.tabs.onUpdated.removeListener(onUpdated);chrome.tabs.onRemoved.removeListener(onRemoved);(ok?resolve:reject)()}})}chrome.tabs.onCreated.addListener(async function(tab){$checkInonlytabs=false;for(var i=0;i<onlytabs.length;i++){if(tab.url.includes(onlytabs[i])===true){$checkInonlytabs=true}}if($checkInonlytabs){var tabs=await getAllTabs({});$counterTab=0;for(var i=0;i<tabs.length;i++){for(var j=0;j<onlytabs.length;j++){if(tab.url.includes(onlytabs[i])===true){$counterTab=$counterTab+1}}}if($counterTab>=1){wait(500);deleteTab(tab);alert("Vui lòng chỉ mở 1 tab chức năng!")}else{}}else{}});chrome.tabs.onRemoved.addListener(function(tabId,removeInfo){if(sender){if(executeTab){if(tabId==executeTab.id){let responseObj={};responseObj["index"]=request.currentObj.index;responseObj["id"]=request.currentObj.id;responseObj["currentObj"]=request.currentObj;responseObj["checkType"]=request.type;cassiopeiaSendResponse(request.data,responseObj,sender,"captcha_stop");resetAll();executeTab=null;sender=null;request=null}}}});function afterUpdateTab(tabId,changeInfo,tab){chrome.storage.local.get("executeTab",function(result){var _executeTab=result.executeTab;chrome.storage.local.get("request",function(result){var _request=result.request;chrome.storage.local.get(["sender"],function(result){var _sender=result.sender;if(changeInfo.hasOwnProperty("url")){if(changeInfo.url.includes("search?q")){console.log("_executeTab 2",_executeTab);if(_executeTab!==null&&tabId===_executeTab.id){console.log("exe");chrome.scripting.executeScript({target:{tabId:tabId},files:["js/tab_script_check_keyword.min.js"]},result=>{console.log("result",result);let responseObj={};if(_request.type==="KeyCheck"){responseObj["index"]=_request.currentObj.index;responseObj["url"]=_request.currentObj.url;responseObj["id"]=_request.currentObj.id;responseObj["stt"]=_request.currentObj.stt}else if(_request.type==="CheckDuplicateContent"){responseObj["index"]=_request.currentObj.index;responseObj["id"]=_request.currentObj.id}else if(_request.type==="CheckBackLinkIndexed"){responseObj["index"]=_request.currentObj.index;responseObj["id"]=_request.currentObj.id;responseObj["backlink"]=_request.currentObj.backlink;responseObj["currentObj"]=_request.currentObj}let temp=[];result.forEach(function(item,index,arr){temp.push(item.result)});if(result[0]!==null&&result[0]!=""){responseObj["content"]=temp}responseObj["currentObj"]=_request.currentObj;cassiopeiaSendResponse(_request.data,responseObj,_sender,_request.type);clearTimeout(executeTabTimeout);executeTabTimeout=0;resetAll();request=null;sender=null;executeTab=null;tabDragging(function(dragging){if(!dragging){wait(500)}})})}else{console.log("Value currently is "+tabId+" executeTab "+_executeTab)}}else{console.log("not include")}}else{console.log("not url",changeInfo)}})})})}chrome.runtime.onInstalled.addListener(async function(details){var tabs=await getAllTabs({});if(tabs&&tabs.hasOwnProperty("length")){for(var i=0;i<tabs.length;i++){if(tabs[i].url.search("https://seominisuite.com")==0){chrome.tabs.reload(tabs[i].id,{},function(){})}}}});chrome.runtime.onMessageExternal.addListener(function(request,sender,sendResponse){sendResponse({response:""})});