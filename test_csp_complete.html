<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete CSP & CORS Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005a87; }
    </style>
</head>
<body>
    <h1>üîß Complete CSP & CORS Test</h1>
    
    <div class="test-section">
        <h2>üìã CSP Status</h2>
        <div id="csp-status">Checking...</div>
    </div>
    
    <div class="test-section">
        <h2>üö´ reCAPTCHA Script Blocking</h2>
        <div id="recaptcha-blocking">Checking...</div>
    </div>
    
    <div class="test-section">
        <h2>üåê CORS Test</h2>
        <div id="cors-test">Ready to test...</div>
        <button onclick="testCORS()">Test CORS API Call</button>
    </div>
    
    <div class="test-section">
        <h2>‚úÖ Server-side Integration</h2>
        <div id="server-integration">Checking...</div>
    </div>
    
    <div class="test-section">
        <h2>üìä Console Logs</h2>
        <div id="console-logs"></div>
    </div>

    <script>
        // Test CSP violations
        const cspStatus = document.getElementById('csp-status');
        const recaptchaBlocking = document.getElementById('recaptcha-blocking');
        const corsTest = document.getElementById('cors-test');
        const serverIntegration = document.getElementById('server-integration');
        const consoleLogs = document.getElementById('console-logs');
        
        let logs = [];
        
        // Override console.log to capture logs
        const originalLog = console.log;
        console.log = function(...args) {
            logs.push(args.join(' '));
            originalLog.apply(console, args);
        };
        
        // Override console.error to capture CSP violations
        const originalError = console.error;
        console.error = function(...args) {
            const message = args.join(' ');
            if (message.includes('Content Security Policy') || 
                message.includes('CSP') || 
                message.includes('script-src') ||
                message.includes('frame-src') ||
                message.includes('CORS')) {
                logs.push('üö´ VIOLATION: ' + message);
            }
            originalError.apply(console, args);
        };
        
        // Test CORS API call
        async function testCORS() {
            corsTest.innerHTML = '<p>Testing CORS API call...</p>';
            
            try {
                const response = await fetch('https://seominisuite.com/cassiopeia-captcha/resolve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        uid: 1,
                        url: 'https://www.google.com/recaptcha/api2/demo',
                        data_sitekey: '6Le-wvkSAAAAAPBMRTvw0Q4Muexq9bi0DJwx_mJ-',
                        data_s: ''
                    })
                });
                
                const data = await response.json();
                corsTest.innerHTML = '<p class="success">‚úÖ CORS API call successful!</p><pre>' + JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                corsTest.innerHTML = '<p class="error">‚ùå CORS API call failed: ' + error.message + '</p>';
            }
        }
        
        // Test 1: Check CSP violations
        setTimeout(() => {
            let cspHtml = '<h3>CSP Test Results:</h3>';
            
            const cspViolations = logs.filter(log => log.includes('VIOLATION'));
            if (cspViolations.length > 0) {
                cspHtml += '<ul>';
                cspViolations.forEach(violation => {
                    cspHtml += `<li class="error">${violation}</li>`;
                });
                cspHtml += '</ul>';
            } else {
                cspHtml += '<p class="success">‚úÖ No CSP violations detected</p>';
            }
            
            cspStatus.innerHTML = cspHtml;
        }, 1000);
        
        // Test 2: Check reCAPTCHA blocking
        setTimeout(() => {
            let recaptchaHtml = '<h3>reCAPTCHA Blocking Test:</h3>';
            
            const blockingLogs = logs.filter(log => log.includes('üö´') && log.includes('reCAPTCHA'));
            const allowingLogs = logs.filter(log => log.includes('‚úÖ') && log.includes('reCAPTCHA'));
            
            if (blockingLogs.length > 0) {
                recaptchaHtml += '<ul>';
                blockingLogs.forEach(log => {
                    recaptchaHtml += `<li class="success">${log}</li>`;
                });
                recaptchaHtml += '</ul>';
            }
            
            if (allowingLogs.length > 0) {
                recaptchaHtml += '<p class="success">‚úÖ reCAPTCHA scripts allowed</p>';
            } else {
                recaptchaHtml += '<p class="warning">‚ö†Ô∏è No reCAPTCHA activity detected</p>';
            }
            
            recaptchaBlocking.innerHTML = recaptchaHtml;
        }, 2000);
        
        // Test 3: Check server-side integration
        setTimeout(() => {
            let serverHtml = '<h3>Server-side Integration Test:</h3>';
            
            const serverLogs = logs.filter(log => log.includes('‚úÖ') && log.includes('Server-side'));
            if (serverLogs.length > 0) {
                serverHtml += '<ul>';
                serverLogs.forEach(log => {
                    serverHtml += `<li class="success">${log}</li>`;
                });
                serverHtml += '</ul>';
            } else {
                serverHtml += '<p class="warning">‚ö†Ô∏è Server-side integration not detected</p>';
            }
            
            serverIntegration.innerHTML = serverHtml;
        }, 3000);
        
        // Test 4: Display all logs
        setTimeout(() => {
            let logsHtml = '<h3>All Console Logs:</h3><pre>';
            logs.forEach(log => {
                logsHtml += log + '\n';
            });
            logsHtml += '</pre>';
            consoleLogs.innerHTML = logsHtml;
        }, 4000);
        
        // Try to load reCAPTCHA script to test
        setTimeout(() => {
            console.log('üß™ Testing reCAPTCHA script loading...');
            const script = document.createElement('script');
            script.src = 'https://www.google.com/recaptcha/api.js';
            script.onload = function() {
                console.log('‚úÖ reCAPTCHA script loaded successfully');
            };
            script.onerror = function() {
                console.log('‚ùå reCAPTCHA script failed to load');
            };
            document.head.appendChild(script);
        }, 500);
        
        // Try to create grecaptcha to test
        setTimeout(() => {
            console.log('üß™ Testing grecaptcha creation...');
            if (typeof grecaptcha !== 'undefined') {
                console.log('‚úÖ grecaptcha exists and is accessible');
                grecaptcha.ready(function() {
                    console.log('‚úÖ grecaptcha.ready() works');
                });
            } else {
                console.log('‚ö†Ô∏è grecaptcha not found - may be blocked');
            }
        }, 2000);
        
        // Test CSP meta tags
        setTimeout(() => {
            console.log('üß™ Checking CSP meta tags...');
            const cspMetaTags = document.querySelectorAll('meta[http-equiv="Content-Security-Policy"]');
            if (cspMetaTags.length > 0) {
                cspMetaTags.forEach((tag, index) => {
                    console.log(`üìã CSP Meta Tag ${index + 1}:`, tag.getAttribute('content'));
                });
            } else {
                console.log('üìã No CSP meta tags found');
            }
        }, 1000);
    </script>
</body>
</html> 